<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Admin Panel - Lucky Draw</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="bg-gray-900 text-white">

    <!-- ðŸ“Œ SIDEBAR -->
    <div class="flex h-screen">

        <aside class="w-64 bg-gray-800 border-r border-gray-700 p-6">
            <h2 class="text-2xl font-bold mb-8 text-blue-400">Admin Panel</h2>

            <nav class="space-y-3">
                <button onclick="showSection('dashboard')"
                    class="w-full py-2 px-4 bg-gray-700 hover:bg-gray-600 rounded-lg">Dashboard</button>
                <button onclick="loadEntries()" class="w-full py-2 px-4 bg-gray-700 hover:bg-gray-600 rounded-lg">Load
                    Entries</button>
                <button onclick="pickWinner()"
                    class="w-full py-2 px-4 bg-blue-600 hover:bg-blue-500 rounded-lg font-semibold">Pick Winner</button>
                <button onclick="logout()"
                    class="w-full py-2 px-4 bg-red-600 hover:bg-red-500 rounded-lg">Logout</button>
            </nav>
        </aside>


        <!-- ðŸ  MAIN CONTENT -->
        <main class="flex-1 p-10 overflow-y-auto">

            <!-- DASHBOARD BOX -->
            <div id="dashboard" class="">
                <h1 class="text-3xl font-bold mb-6">Welcome Admin ðŸ‘‹</h1>
                <p class="text-gray-300">Use the sidebar to manage entries and pick winners.</p>
            </div>


            <!-- TABLE SECTION -->
            <div id="tableSection" class="hidden">

                <div class="flex items-center justify-between mb-4">
                    <h2 class="text-2xl font-bold">Entries</h2>

                    <!-- ðŸ” SEARCH -->
                    <input id="searchInput" onkeyup="searchFilter()" type="text" placeholder="Search by name / phone..."
                        class="px-4 py-2 rounded-lg bg-gray-800 border border-gray-700 focus:ring-2 focus:ring-blue-500 w-64">
                </div>

                <!-- TABLE -->
                <div class="overflow-x-auto rounded-lg border border-gray-700">
                    <table class="w-full text-left">
                        <thead class="bg-gray-800 uppercase text-sm">
                            <tr>
                                <th class="px-4 py-3">Name</th>
                                <th class="px-4 py-3">Phone</th>
                                <th class="px-4 py-3">Ticket</th>
                            </tr>
                        </thead>
                        <tbody id="entryTable" class="divide-y divide-gray-700"></tbody>
                    </table>
                </div>

                <!-- PAGINATION -->
                <div class="flex justify-between mt-4">
                    <button onclick="prevPage()"
                        class="px-4 py-2 bg-gray-700 hover:bg-gray-600 rounded-lg">Previous</button>
                    <span id="pageInfo" class="text-gray-300"></span>
                    <button onclick="nextPage()"
                        class="px-4 py-2 bg-gray-700 hover:bg-gray-600 rounded-lg">Next</button>
                </div>

            </div>


            <!-- ðŸŽ‰ WINNER BOX -->
            <div id="winnerBox"
                class="hidden mt-8 p-6 bg-green-700 rounded-lg border border-green-500 text-center animate-bounce">
            </div>

        </main>
    </div>


    <script>

        const ADMIN_USER = "prince7777";
        const ADMIN_PASS = "q btau";

        const API_URL = "https://script.google.com/macros/s/AKfycbxxNRyrrifFBefdV5InYotCFk2FMXP1umYnkMSqjr3OWqLEiEcKFIVw7o7_ESS0--sM6w/execL";

        let allEntries = [];
        let filteredEntries = [];
        let currentPage = 1;
        let perPage = 8;

        // LOGIN AUTO CHECK
        window.onload = () => {
            if (!localStorage.getItem("adminAuth")) {
                alert("Login first!");
                location.href = "index.html";
            }
        };


        function logout() {
            localStorage.removeItem("adminAuth");
            location.reload();
        }

        function showSection(id) {
            document.getElementById("dashboard").classList.add("hidden");
            document.getElementById("tableSection").classList.add("hidden");
            document.getElementById(id).classList.remove("hidden");
        }


        // ðŸ“Œ LOAD ENTRIES
        async function loadEntries() {
            const res = await fetch(API_URL);
            allEntries = await res.json();
            filteredEntries = allEntries;

            currentPage = 1;

            showSection("tableSection");
            renderTable();
        }


        // ðŸ” SEARCH FILTER
        function searchFilter() {
            let q = document.getElementById("searchInput").value.toLowerCase();

            filteredEntries = allEntries.filter(e =>
                e.name.toLowerCase().includes(q) ||
                e.phone.toLowerCase().includes(q)
            );

            currentPage = 1;
            renderTable();
        }


        // ðŸ“„ PAGINATION
        function renderTable() {
            let table = document.getElementById("entryTable");
            table.innerHTML = "";

            let start = (currentPage - 1) * perPage;
            let end = start + perPage;

            let pageData = filteredEntries.slice(start, end);

            pageData.forEach(e => {
                table.innerHTML += `
          <tr class='hover:bg-gray-800'>
            <td class='px-4 py-3'>${e.name}</td>
            <td class='px-4 py-3'>${e.phone}</td>
            <td class='px-4 py-3'>${e.ticket}</td>
          </tr>
        `;
            });

            document.getElementById("pageInfo").innerText =
                `Page ${currentPage} of ${Math.ceil(filteredEntries.length / perPage)}`;
        }


        function nextPage() {
            if (currentPage < Math.ceil(filteredEntries.length / perPage)) {
                currentPage++;
                renderTable();
            }
        }

        function prevPage() {
            if (currentPage > 1) {
                currentPage--;
                renderTable();
            }
        }


        // ðŸŽ‰ RANDOM WINNER
        async function pickWinner() {
            const res = await fetch(API_URL);
            const data = await res.json();

            if (data.length === 0) {
                alert("No entries!");
                return;
            }

            const random = data[Math.floor(Math.random() * data.length)];

            let box = document.getElementById("winnerBox");
            box.classList.remove("hidden");

            box.innerHTML = `
        <h2 class='text-3xl font-bold mb-2'>ðŸŽ‰ Winner ðŸŽ‰</h2>
        <p><strong>Name:</strong> ${random.name}</p>
        <p><strong>Phone:</strong> ${random.phone}</p>
        <p><strong>Ticket:</strong> ${random.ticket}</p>
      `;

            box.classList.add("animate-bounce");
            setTimeout(() => box.classList.remove("animate-bounce"), 1500);
        }

    </script>

</body>

</html>